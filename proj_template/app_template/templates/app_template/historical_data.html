{% extends 'app_template/base.html' %}

{% block content %}
<div class="container mt-5 text-center">
    <h1>The History Of Elo Scores In the NFL</h1>

    <form id="teamForm" class="form-inline justify-content-center mb-3" method="get"
        action="{% url 'app_template.historical_data' %}">
        <select id="teamSelect" name="team_abbreviation" class="form-control mr-2" onchange="this.form.submit()">
            <option value="">Change Team</option>
            {% for team in nfl_teams %}
            <option value="{{ team.abbreviation }}" style="color: {{ team.color_hex }};" {% if selected_team and team.abbreviation == selected_team.abbreviation %} selected {% endif %}>
                {{ team.name }}
            </option>
            {% endfor %}
        </select>
    </form>

    <h2>{{ selected_team.name }}</h2>
    {% if selected_team %}
        <div id="container" style="width:100%; height:400px;"></div>
    {% else %}
        <p>Please select a team to view historical games.</p>
    {% endif %}
</div>

{% if historical_games %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script>
    
    document.addEventListener('DOMContentLoaded', function () {
        Highcharts.chart('container', {
            chart: {
                type: 'line',
                zoomType: 'x'  // Enable zooming on the x-axis
            },
            title: {
                text: 'Elo Scores Over Time'
            },
            xAxis: {
                type: 'datetime',
                title: {
                    text: 'Date'
                },
            },
            yAxis: {
                title: {
                    text: 'Elo Score'
                }
            },
            series: [{
                name: 'Elo Score',
                color: '{{ selected_team.color_hex }}',
                lineWidth: 3,
                marker: {
                    lineColor: '{{ selected_team.color_hex }}',
                    fillColor: '{{ selected_team.color_hex }}',
                    radius: 4
                },
                data: [
                    {% for game in historical_games %}
                        [Date.parse('{{ game.date }}'), {{ game.elo1_post }}],
                    {% endfor %}
                ]
            }],
            credits: {
                enabled: false  // Disable Highcharts credits
            }
        });
    });

</script>
{% endif %}
{% endblock %}
